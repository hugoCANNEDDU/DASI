<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>interventionsDuJour</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
        <link rel="stylesheet" href="miseEnFormeEmploye.css" type="text/css" >  
        <style type="text/css">
            html, body { height: 100%; margin: 0; padding: 0; }
            h1 { text-align: center; }
            #map { height: 90%;
                   margin: 1% 1%}
        </style>
    </head>
     <body>
        <div class="connect"> 
        <div>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 118 95" preserveAspectRatio="xMidYMid meet" width="49pt" height="40pt" version="1.0">
                <g fill="#000000" stroke="none" transform="translate(0 95) scale(0.1 -0.1)">
                <path d="M 780 907 c -65 -34 -90 -76 -120 -205 l -12 -53 l -46 4 l -45 3 l -13 52 c -18 68 -77 157 -116 173 c -26 10 -35 10 -57 -2 c -49 -28 -37 -129 27 -222 l 35 -50 l -17 -52 c -9 -28 -16 -59 -16 -68 c 0 -9 -15 -20 -35 -27 c -42 -14 -61 -36 -22 -27 c 14 4 32 9 40 13 c 25 9 30 -28 7 -59 c -26 -34 -19 -48 10 -22 c 20 18 21 18 53 -13 c 68 -66 231 -69 294 -6 c 20 20 31 24 61 19 l 37 -6 l -28 18 c -40 26 -35 67 11 71 c 39 4 42 19 5 24 c -23 3 -31 12 -50 63 l -23 59 l 24 36 c 78 114 106 230 66 270 c -23 23 -36 25 -70 7 Z m 56 -75 c 1 -29 -3 -55 -7 -58 c -5 -3 -9 4 -9 16 c 0 29 -18 60 -35 60 c -7 0 -27 -17 -44 -37 c -23 -28 -31 -33 -31 -19 c 0 29 75 98 102 94 c 20 -3 23 -9 24 -56 Z m -386 6 c 12 -13 28 -36 36 -53 c 12 -25 8 -23 -24 14 c -44 51 -69 51 -79 0 c -3 -19 -9 -26 -13 -19 c -7 11 -5 33 6 68 c 6 20 52 14 74 -10 Z m 348 -57 c 2 -20 -8 -57 -29 -102 c -32 -70 -32 -71 -19 -136 c 13 -69 8 -82 -32 -83 c -9 0 -20 -5 -24 -12 c -5 -8 3 -9 30 -5 c 31 5 37 3 34 -11 c -2 -11 -11 -16 -26 -14 c -26 4 -29 -13 -5 -27 c 50 -27 -88 -79 -161 -60 c -17 4 -43 11 -58 14 c -35 7 -66 51 -49 68 c 17 17 13 29 -9 22 c -27 -9 -25 9 3 23 l 22 11 l -22 7 c -27 7 -29 28 -8 77 c 21 51 19 79 -10 133 c -24 46 -34 124 -16 124 c 14 0 65 -71 88 -125 c 19 -45 25 -51 60 -57 c 21 -4 52 -7 70 -7 c 29 -1 33 3 47 47 c 20 59 83 155 99 149 c 7 -2 13 -18 15 -36 Z" />
                <path d="M 503 543 c -18 -6 -16 -40 1 -46 c 8 -3 20 1 27 9 c 10 12 9 18 -2 28 c -8 8 -20 12 -26 9 Z" />
                <path d="M 640 511 c 0 -27 19 -36 37 -18 c 18 18 9 37 -18 37 c -12 0 -19 -7 -19 -19 Z" />
                <path d="M 561 461 c -12 -8 -13 -12 -1 -26 c 11 -14 11 -19 -3 -33 c -11 -10 -17 -12 -17 -4 c 0 7 -4 12 -10 12 c -21 0 -9 -35 16 -47 c 31 -14 91 -6 99 15 c 8 21 -2 27 -20 12 c -12 -10 -16 -9 -21 4 c -3 9 -1 23 6 31 c 26 31 -12 59 -49 36 Z" />
                <path d="M 150 596 c -73 -13 -90 -21 -90 -42 c 0 -9 11 -14 36 -14 c 21 0 47 -8 61 -20 c 14 -11 31 -20 38 -20 c 21 0 65 40 65 59 c 0 16 -30 53 -41 50 c -2 0 -33 -6 -69 -13 Z m 68 -48 c -3 -7 -11 -13 -18 -13 c -7 0 -15 6 -17 13 c -3 7 4 12 17 12 c 13 0 20 -5 18 -12 Z" />
                <path d="M 951 530 c -6 -28 -11 -53 -11 -56 c 0 -5 109 -54 121 -54 c 18 0 8 38 -11 43 c -17 4 -19 9 -10 32 c 13 35 13 35 -10 35 c -11 0 -20 -7 -20 -15 c 0 -8 -4 -15 -9 -15 c -6 0 -6 12 -1 30 c 7 25 5 32 -10 40 c -27 15 -27 14 -39 -40 Z" />
                <path d="M 173 448 c -56 -22 -75 -55 -28 -46 c 28 6 30 1 13 -54 c -8 -29 -9 -41 0 -50 c 15 -15 48 13 56 48 c 4 15 14 24 26 24 c 29 0 47 42 32 75 c -14 30 -30 30 -99 3 Z m 69 -40 c -15 -15 -26 -4 -18 18 c 5 13 9 15 18 6 c 9 -9 9 -15 0 -24 Z" />
                <path d="M 915 442 c -17 -12 -45 -69 -45 -91 c 0 -25 25 -28 38 -5 c 8 14 12 12 29 -12 c 11 -16 18 -35 16 -41 c -3 -8 4 -13 19 -13 c 18 0 29 9 41 35 c 9 20 17 42 17 50 c 0 18 -21 20 -38 3 c -17 -17 -53 18 -50 50 c 3 26 -10 37 -27 24 Z" />
                <path d="M 271 331 c -26 -7 -55 -42 -66 -78 c -8 -28 25 -63 60 -63 c 29 0 90 51 98 81 c 4 14 -2 29 -18 45 c -25 25 -34 27 -74 15 Z m 49 -44 c 0 -25 -31 -57 -56 -57 c -29 0 -32 24 -7 52 c 18 21 63 24 63 5 Z" />
                <path d="M 820 301 c 0 -16 7 -34 15 -41 c 12 -10 17 -8 26 13 c 15 32 6 57 -21 57 c -15 0 -20 -7 -20 -29 Z" />
                <path d="M 723 246 c -50 -24 -61 -60 -17 -54 c 24 3 28 -1 39 -45 c 14 -55 27 -72 49 -64 c 21 8 20 30 -4 77 c -25 49 -25 56 1 63 c 26 7 22 42 -6 43 c -11 1 -39 -8 -62 -20 Z" />
                <path d="M 372 196 c -56 -58 -74 -86 -55 -86 c 4 0 17 10 29 21 c 16 15 30 20 47 15 c 21 -5 25 -12 23 -38 c -1 -40 25 -46 35 -8 c 13 46 10 160 -4 160 c -7 0 -40 -29 -75 -64 Z" />
                <path d="M 562 223 c -18 -7 -42 -58 -42 -90 c 0 -58 62 -97 98 -61 c 18 18 14 28 -12 28 c -32 0 -45 19 -39 53 c 4 18 15 32 30 38 c 21 8 23 12 13 24 c -13 15 -25 17 -48 8 Z" />
                </g>
            </svg>
        </div>
        <div><img src="http://www.betterbet.it/img/user.png" align="center" height="58" width="50" /></div>
        <div> Employé
        <span id="mail"></span>
        </div>
        <a href="index.html">Déconnexion</a>
 
        </div>
    <div class="co"> 
    <nav>
	<!--<p class="mrgn-tp-md"><a href="#details-panel3" class="wb-tabs-ext">Voir le troisième panneau</a></p>-->
        <ul>
            <li style="background-color:#F0E68C"><a href="interventionEnCours.html">INTERVENTION EN COURS</a></li>
            <li style="background-color:#CCCCCC"><a href="interventionsDuJour.html">INTERVENTIONS DU JOUR</a></li>
            <li style="background-color:#F0E68C"><a href="informationsPersonnelles.html">INFORMATIONS PERSONNELLES</a></li>
        </ul>
        
    </nav>
    </div>
         
    <div id="map"></div>

    <script type="text/javascript">

        var googleMapInstance = null;

        function makeInfoWindow(title) {
            return new google.maps.InfoWindow({
                content: '<div>Information: ' + title + '</div>'
            });
        }

        function attachInfoWindow(marker, infowindow, htmlDescription) {
            marker.addListener('click', function () {

                infowindow.setContent(htmlDescription);
                infowindow.open(googleMapInstance, this);
            });
        }

        function initMap() {

            googleMapInstance = new google.maps.Map(document.getElementById('map'), {
                center: {lat: 45.7601424, lng: 4.8961779},
                zoom: 13
            });

            var infowindow = makeInfoWindow('');

            // Simuler un appel AJAX (attente 5s)
            setTimeout(
                    interventionJour,
                    5000
                    );
        }

        function infoPers() {
            console.log("fonction ok");/*recupère les params passés par la fenêtre précedente*/
            $.ajax({
                url: './ActionServlet',
                method: 'POST',
                data: {
                    todo: 'recupererInfo'
                },
                dataType: 'json'
            }).done(function (data) {
                var mail = data.mail;
                console.log(data.mail);
                // si connexion ok, aller sur la page suivante :
                $('#mail').html(mail);
            });
        }
            
        function interventionJour(){
            $.ajax({
                url: './ActionServlet',
                method: 'POST',
                data: {
                    todo: 'recupererListeInterventionJour'
                },
                dataType: 'json'
            }).done(function (data) {
                var infowindow = makeInfoWindow('');
                var position = {lat: 45.782122, lng: 4.872735};

                $.each(data.intervention,function(i,intervention){
                    console.log('coucou');
                    var iconImage = null;
                    var marker= new google.maps.Marker({
                        map : googleMapInstance,
                        position: {lat: intervention.lat, lng: intervention.lng},
                        title: 'Endroit #' + i,
                        icon: iconImage
                    });

                    attachInfoWindow(marker, infowindow,'Type :'+intervention.type);
                });
            });
        }
            
        $(document).ready(function () {
            // ajout d'un "handler" sur le clic du bouton de connexion
            infoPers();
        });
        </script>
        
        <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAklw96N9rLd93ubr-F04CN7qi2ryKayAc&callback=initMap">
        </script>

    </body>
</html>
